应用日志设计与实现
====================

***本方案讨论系统应用日志的设计与实现***


目标
----

 - 低系统占用率
 - 尽量不阻碍系统正常运行流程
 - 可动态调整日志级别
 - 灵活的扩展性(可配置的将日志输出到不到后端)


方案
----

*技术*

 - Akka 2
 - Mongodb

使用akka actor基于事件的消息路由机制在进程内、外进行日志的路由。logger只做日志路由，并不处理实际的日志写入文件或存入DB事项。由另外的专门的日志持久化服务订阅logger的日志消息以处理持久化任务。


实现
----

***一个简单的路由流程***

 - logger.info("在此输出日志消息")	// 使用scala call by name方式传入参数
 - 根据日志级别判断此日志当前是否有效
 - 将当前有效日志送入LoggerSystem，由LoggerSystem路由到对此日志感兴趣的订阅者
 - 订阅者收到感觉兴趣的日志，判断后进行处理   <过程R>

以上处理流程中，LoggerSystem做为进程内的Actor，只负责日志消息的过滤和路由。对于订阅者而言，它是一个生产者。所有订阅者都与LoggerSystem处于同一JVM进程中。

更进一步，我们可以使用akka actor remote功能方便的把日志消息路由到远程日志服务器上。这样本机应该只是对日志做一个简单的过虑后直接扔到网络上，当可进一步减轻日志对应用系统的损耗。

*过程R:*

在过程R中，订阅者可以对收到的消息进行持久化，也可以将消息remote到远程日志服务器，由远程日志服务器做进一步处理。


总结
----


